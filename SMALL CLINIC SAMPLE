CREATE TABLE STUFF ( SID NUMBER(5) NOT NULL PRIMARY KEY  ,NAME VARCHAR2 (100) NOT NULL , JOB VARCHAR2 (100) NOT NULL , SAL NUMBER ) ;

CREATE TABLE PATIENT ( PID NUMBER(5) NOT NULL PRIMARY KEY  ,NAME VARCHAR2 (100) NOT NULL , APPOINMENT_DATE DATE ) ;

ALTER TABLE STUFF ADD ( PID NUMBER(5) ,CONSTRAINT PID_FK_S FOREIGN KEY (PID) REFERENCES PATIENT (PID)) ;

CREATE TABLE  MEDICINE ( MID NUMBER(5) NOT NULL PRIMARY KEY  , TYPE VARCHAR2 (100) NOT NULL , PID NUMBER(5) , SID NUMBER(5) , CONSTRAINT PID_FK_M FOREIGN KEY (PID) REFERENCES PATIENT (PID) , CONSTRAINT SID_FK_M FOREIGN KEY(SID ) REFERENCES STUFF (SID) ) ;

CREATE TABLE DIAGNOSIS ( DID NUMBER(5) NOT NULL PRIMARY KEY  , DIAGNOSTIC VARCHAR2 (100) NOT NULL ,  PID NUMBER(5) , SID NUMBER(5) , CONSTRAINT PID_FK_D FOREIGN KEY (PID) REFERENCES PATIENT (PID) , CONSTRAINT SID_FK_D FOREIGN KEY(SID ) REFERENCES STUFF (SID)) ;

ALTER TABLE PATIENT ADD  ( DID NUMBER(5) , CONSTRAINT DID_FK_P FOREIGN KEY (DID) REFERENCES DIAGNOSIS (DID) ) ;

CREATE SEQUENCE SID_SQ MINVALUE 1 MAXVALUE 5000 START WITH 1 INCREMENT BY  1 ;
CREATE SEQUENCE PID_SQ MINVALUE 1 MAXVALUE 5000 START WITH 1 INCREMENT BY  1 ;
CREATE SEQUENCE MID_SQ MINVALUE 1 MAXVALUE 5000 START WITH 1 INCREMENT BY  1 ;
CREATE SEQUENCE DID_SQ MINVALUE 1 MAXVALUE 5000 START WITH 1 INCREMENT BY  1 ;

---------------------------------------

insert into stuff (sid , name , job , sal ) values ( sid_sq.nextval , 'WAJD' , 'health informatics' , 10000 ) ;

INSERT into stuff (sid , name , job , sal ) values ( sid_sq.nextval , 'ALI' , 'NURSE' , 10000 ) ;

INSERT into stuff (sid , name , job , sal ) values ( sid_sq.nextval , 'ABEER' , 'DOCTOR' , 10000 ) ;

INSERT into stuff (sid , name , job , sal ) values ( sid_sq.nextval , 'MOHAMED' , 'pharmacist' , 10000 ) ;



INSERT INTO PATIENT (PID , NAME , APPOINMENT_DATE ) VALUES (PID_SQ.NEXTVAL , 'OMAR' , '8/27/2023') ;

INSERT INTO PATIENT (PID , NAME , APPOINMENT_DATE ) VALUES (PID_SQ.NEXTVAL , 'LAILA' , '9/10/2023') ;

INSERT INTO PATIENT (PID , NAME , APPOINMENT_DATE ) VALUES (PID_SQ.NEXTVAL , 'AMINA' , '8/22/2023') ;


UPDATE STUFF SET PID =23   WHERE JOB='NURSE' ;
UPDATE STUFF SET PID = 21  WHERE NAME='MOHAMED' ;
UPDATE STUFF SET PID = 22  WHERE SID = 5 ;


INSERT INTO DIAGNOSIS ( DID , DIAGNOSTIC , SID , PID ) VALUES (DID_SQ.NEXTVAL , 'ALLERGIE' , 4 , 23) ;

INSERT INTO DIAGNOSIS ( DID , DIAGNOSTIC , SID , PID ) VALUES (DID_SQ.NEXTVAL , 'ASTHMA' , 6 , 21) ;

INSERT INTO DIAGNOSIS ( DID , DIAGNOSTIC , SID , PID ) VALUES (DID_SQ.NEXTVAL , 'OSTEOPOROSIS' , 5 , 22) ;



INSERT INTO MEDICINE (MID , TYPE , SID , PID ) VALUES ( MID_SQ.NEXTVAL , 'ANTIHISTAMINES' , 4 , 23) ;

INSERT INTO MEDICINE (MID , TYPE , SID , PID ) VALUES ( MID_SQ.NEXTVAL , 'INHALED CORTICOSTEROIDS' , 6 , 21) ;

INSERT INTO MEDICINE (MID , TYPE , SID , PID ) VALUES ( MID_SQ.NEXTVAL , 'ALENDRONATE (FOSAMAX)' , 5 , 22) ;

INSERT INTO MEDICINE (MID , TYPE , SID , PID ) VALUES ( MID_SQ.NEXTVAL , 'RISEDRONATE (ACTONEL)' , 5 , 22) ;



UPDATE PATIENT SET DID = 21  WHERE  PID = 21 ;
UPDATE PATIENT SET DID =  1  WHERE  PID = 22 ;
UPDATE PATIENT SET DID = 22 WHERE  NAME = 'AMINA' ;

----------------------------------------


CREATE OR REPLACE VIEW PATIENT_MEDICATION_V AS
SELECT P.PID , P.NAME AS PATIENT  , S.NAME AS STUFF , D. DIAGNOSTIC , M.TYPE AS MEDICINE , 
COUNT(TYPE) OVER (PARTITION BY P.PID ) AS COUNT_PATIENT_MED , 
(CASE TYPE
WHEN 'ANTIHISTAMINES' THEN 'Do not take 2 antihistamines together'
WHEN 'INHALED CORTICOSTEROIDS' THEN 'Avoid all immunizations while on steroids'
WHEN'ALENDRONATE (FOSAMAX)' THEN 'This medicine could lower the amount of calcium in your blood'
WHEN 'RISEDRONATE (ACTONEL)' THEN 'Risedronate may cause ulcers (sores) in the esophagus'
ELSE 'NO COMMENT' END) AS CAUTION_MEDICINE
FROM PATIENT P JOIN MEDICINE M ON P.PID = M.PID JOIN DIAGNOSIS D ON P.DID=D.DID JOIN STUFF S ON S.PID = P.PID
ORDER BY COUNT_PATIENT_MED DESC

-----------------------------------------
